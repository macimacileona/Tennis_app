{% extends "base.html" %}

{% block title %}User Profile{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card shadow">
        <div class="card-header bg-primary text-white">
          <h3>User Profile</h3>
        </div>
        <div class="card-body">
          <!-- Form now posts to update_profile endpoint -->
          <form method="POST" action="{{ url_for('update_profile') }}">
            <div class="row mb-4">
              <div class="col-md-4 text-center">
                <div class="profile-image mb-3">
                  <i class="fas fa-user-circle fa-5x text-secondary"></i>
                </div>
                <h4 class="fw-bold">{{ user.username }}</h4>
              </div>
              <div class="col-md-8">
                <h5>Account Information</h5>
                <hr>
                <!-- Each row: Label and Input on the same line -->
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="email" class="form-label">Email</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="email" class="form-control" id="email" name="email" 
                           value="{{ user.email }}" required>
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="phone" class="form-label">Phone Number</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="tel" class="form-control" id="phone" name="phone" 
                           value="{{ user.phone }}" pattern="\+?[0-9]+" title="Only numbers and optional + sign allowed">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="win_ratio" class="form-label">Win Ratio</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="text" class="form-control" id="win_ratio" name="win_ratio" 
                           value="{{ user.win_ratio }}" readonly placeholder="Will be calculated">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="weight" class="form-label">Weight (kg)</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="weight" name="weight" 
                           value="{{ user.weight }}" min="30" max="200" step="1">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="height" class="form-label">Height (cm)</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="height" name="height" 
                           value="{{ user.height }}" min="100" max="250" step="1">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="birth_year" class="form-label">Year of Birth</label>
                  </div>
                  <div class="col-sm-9">
                    <input type="number" class="form-control" id="birth_year" name="birth_year" 
                           value="{{ user.birth_year }}" min="1900" max="2023" step="1">
                  </div>
                </div>
                <div class="row mb-2 align-items-center">
                  <div class="col-sm-3">
                    <label for="handedness" class="form-label">Handedness</label>
                  </div>
                  <div class="col-sm-9">
                    <select class="form-select" id="handedness" name="handedness">
                      <option value="">Select...</option>
                      <option value="left" {% if user.handedness == 'left' %}selected{% endif %}>Left</option>
                      <option value="right" {% if user.handedness == 'right' %}selected{% endif %}>Right</option>
                    </select>
                  </div>
                </div>
                <!-- Action Buttons Centered and Next to Each Other -->
                <div class="row mt-4">
                  <div class="col d-flex justify-content-center gap-3">
                    <a href="{{ url_for('home') }}" class="btn btn-secondary">Back to Home</a>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Script for phone number validation -->
<script>
document.getElementById('phone').addEventListener('input', function(e) {
    this.value = this.value.replace(/[^0-9+]/g, '');
});
</script>
{% endblock %}
